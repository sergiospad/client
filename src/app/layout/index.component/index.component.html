@if (fullPosts && user) {
  <div class="posts-container">
    @for (post of fullPosts; track post.id) {
      <mat-card class="post-card" appearance="outlined">

        <mat-card-header class="post-header">
          <div class="post-user-info">
            <div class="post-user-details">
              <mat-card-title class="post-title">{{ post.title }}</mat-card-title>
              <mat-card-subtitle class="post-subtitle">
                {{ post.location }}
              </mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>

        @if (post.img&&post.img[0]&&post.img[0]!='data:text/xml;base64,') {
          <img mat-card-image
               class="post-image"
               [src]="post.img[0]"
               [alt]="post.title">
        }

        @if (post.caption) {
          <mat-card-content class="post-content">
            <p class="post-caption">{{ post.caption }}</p>
          </mat-card-content>
        }

        <mat-card-actions class="post-actions">
          <button mat-icon-button
                  class="like-btn"
                  [class.liked]="post.likedUsers.includes(user.id)"
                  [class.not-liked]="!post.likedUsers.includes(user.id)"
                  (click)="likePost(post)">
            <div>
              <mat-icon>favorite</mat-icon>
              <span class="like-count">{{ post.likedUsers.length || 0 }}</span>
            </div>
          </button>
        </mat-card-actions>

        <div class="comments-section">
          @if (post.fullComments && post.fullComments.length > 0) {
            <div class="comments-list">
              @for (comment of post.fullComments; track comment.id; let last = $last) {
                <div class="comment-item" [class.last-comment]="last">
                  <img [src]="getAvatar(comment.commentatorId)">
                  <span class="comment-username">{{ comment.firstname }} {{comment.lastname}}</span>
                  <span class="comment-text">{{ comment.message }}</span>
                  <span>{{comment.creationDate | dateFormat}}</span>
                </div>
              }
            </div>
          }

          <mat-form-field class="comment-field" appearance="outline">
            <mat-label>Add a comment...</mat-label>
            <input matInput
                   #commentInput
                   placeholder="Write a comment"
                   (keyup.enter)="postComment(commentInput.value, post)">
            <mat-hint align="end">{{ commentInput.value.length }}/128</mat-hint>
          </mat-form-field>
        </div>

      </mat-card>
    }

    @empty {
      <div class="empty-state">
        <mat-icon class="empty-icon">photo_library</mat-icon>
        <h3>No posts yet</h3>
        <p>Be the first to share something!</p>
      </div>
    }
  </div>
}
